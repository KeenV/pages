<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue Loader | Hello VuePress</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Just playing around">
    <link rel="preload" href="vuepress-notes/assets/css/0.styles.51d78afe.css" as="style"><link rel="preload" href="vuepress-notes/assets/js/app.af0a4d6f.js" as="script"><link rel="preload" href="vuepress-notes/assets/js/2.bd6c3abc.js" as="script"><link rel="preload" href="vuepress-notes/assets/js/54.c6cb65e4.js" as="script"><link rel="prefetch" href="vuepress-notes/assets/js/10.6d3d50d5.js"><link rel="prefetch" href="vuepress-notes/assets/js/11.2f3ae474.js"><link rel="prefetch" href="vuepress-notes/assets/js/12.fb9d07eb.js"><link rel="prefetch" href="vuepress-notes/assets/js/13.039a63dd.js"><link rel="prefetch" href="vuepress-notes/assets/js/14.1ccc6241.js"><link rel="prefetch" href="vuepress-notes/assets/js/15.46ada67a.js"><link rel="prefetch" href="vuepress-notes/assets/js/16.048d7b72.js"><link rel="prefetch" href="vuepress-notes/assets/js/17.7fa96304.js"><link rel="prefetch" href="vuepress-notes/assets/js/18.809667ff.js"><link rel="prefetch" href="vuepress-notes/assets/js/19.706e65e4.js"><link rel="prefetch" href="vuepress-notes/assets/js/20.125fdc9d.js"><link rel="prefetch" href="vuepress-notes/assets/js/21.8b36f57a.js"><link rel="prefetch" href="vuepress-notes/assets/js/22.88aad831.js"><link rel="prefetch" href="vuepress-notes/assets/js/23.76d8eaea.js"><link rel="prefetch" href="vuepress-notes/assets/js/24.43c00292.js"><link rel="prefetch" href="vuepress-notes/assets/js/25.75bf1376.js"><link rel="prefetch" href="vuepress-notes/assets/js/26.e475bbfa.js"><link rel="prefetch" href="vuepress-notes/assets/js/27.2b0be49b.js"><link rel="prefetch" href="vuepress-notes/assets/js/28.152abfd6.js"><link rel="prefetch" href="vuepress-notes/assets/js/29.4fe95be9.js"><link rel="prefetch" href="vuepress-notes/assets/js/3.5a732a53.js"><link rel="prefetch" href="vuepress-notes/assets/js/30.d8f28aab.js"><link rel="prefetch" href="vuepress-notes/assets/js/31.97816c3c.js"><link rel="prefetch" href="vuepress-notes/assets/js/32.c076e89a.js"><link rel="prefetch" href="vuepress-notes/assets/js/33.bb5038d4.js"><link rel="prefetch" href="vuepress-notes/assets/js/34.7d5fd850.js"><link rel="prefetch" href="vuepress-notes/assets/js/35.b396868e.js"><link rel="prefetch" href="vuepress-notes/assets/js/36.42c170c9.js"><link rel="prefetch" href="vuepress-notes/assets/js/37.e6e5c5a2.js"><link rel="prefetch" href="vuepress-notes/assets/js/38.22401e36.js"><link rel="prefetch" href="vuepress-notes/assets/js/39.fbe05a17.js"><link rel="prefetch" href="vuepress-notes/assets/js/4.092c4e1c.js"><link rel="prefetch" href="vuepress-notes/assets/js/40.26cc9141.js"><link rel="prefetch" href="vuepress-notes/assets/js/41.c2602328.js"><link rel="prefetch" href="vuepress-notes/assets/js/42.c51b9b2c.js"><link rel="prefetch" href="vuepress-notes/assets/js/43.5176df1a.js"><link rel="prefetch" href="vuepress-notes/assets/js/44.efee0868.js"><link rel="prefetch" href="vuepress-notes/assets/js/45.b9b05cee.js"><link rel="prefetch" href="vuepress-notes/assets/js/46.de8d6817.js"><link rel="prefetch" href="vuepress-notes/assets/js/47.6add5f76.js"><link rel="prefetch" href="vuepress-notes/assets/js/48.3257d2ec.js"><link rel="prefetch" href="vuepress-notes/assets/js/49.d89da9a2.js"><link rel="prefetch" href="vuepress-notes/assets/js/5.cb6932c3.js"><link rel="prefetch" href="vuepress-notes/assets/js/50.101ed1cb.js"><link rel="prefetch" href="vuepress-notes/assets/js/51.8299c693.js"><link rel="prefetch" href="vuepress-notes/assets/js/52.f5040199.js"><link rel="prefetch" href="vuepress-notes/assets/js/53.53caf24c.js"><link rel="prefetch" href="vuepress-notes/assets/js/6.67ff4372.js"><link rel="prefetch" href="vuepress-notes/assets/js/7.2a9feff7.js"><link rel="prefetch" href="vuepress-notes/assets/js/8.f349409c.js"><link rel="prefetch" href="vuepress-notes/assets/js/9.249683af.js">
    <link rel="stylesheet" href="vuepress-notes/assets/css/0.styles.51d78afe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-notes/" class="home-link router-link-active"><!----> <span class="site-name">Hello VuePress</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/vuepress-notes/" aria-current="page" class="sidebar-link">Initial Page</a></li><li><a href="/vuepress-notes/babel.html" class="sidebar-link">Babel</a></li><li><a href="/vuepress-notes/bezier-curve.html" class="sidebar-link">贝赛尔曲线</a></li><li><a href="/vuepress-notes/cors.html" class="sidebar-link">跨域资源共享\(CORS\)</a></li><li><a href="/vuepress-notes/dns.html" class="sidebar-link">DNS</a></li><li><a href="/vuepress-notes/docker.html" class="sidebar-link">Docker</a></li><li><a href="/vuepress-notes/gaussian-blur.html" class="sidebar-link">高斯模糊</a></li><li><a href="/vuepress-notes/git.html" class="sidebar-link">git</a></li><li><a href="/vuepress-notes/http.html" class="sidebar-link">状态码</a></li><li><a href="/vuepress-notes/husky.html" class="sidebar-link">husky</a></li><li><a href="/vuepress-notes/javascript.html" class="sidebar-link">JavaScript 知识点</a></li><li><a href="/vuepress-notes/k8s.html" class="sidebar-link">Kubernetes</a></li><li><a href="/vuepress-notes/matrix.html" class="sidebar-link">matrix</a></li><li><a href="/vuepress-notes/mpvue.html" class="sidebar-link">mpvue源码阅读</a></li><li><a href="/vuepress-notes/nginx.html" class="sidebar-link">Nginx</a></li><li><a href="/vuepress-notes/pixel.html" class="sidebar-link">设备像素与设备独立像素</a></li><li><a href="/vuepress-notes/software.html" class="sidebar-link">brew</a></li><li><a href="/vuepress-notes/source-maps.html" class="sidebar-link">Source maps</a></li><li><a href="/vuepress-notes/svg.html" class="sidebar-link">svg</a></li><li><a href="/vuepress-notes/x5.html" class="sidebar-link">腾讯x5浏览器内核</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/vuepress-notes/css/" class="sidebar-heading clickable"><span>css</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vuepress-notes/flutter/" class="sidebar-heading clickable"><span>flutter</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vuepress-notes/react/" class="sidebar-heading clickable"><span>react</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vuepress-notes/typescript/" class="sidebar-heading clickable"><span>typescript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vuepress-notes/vue/" class="sidebar-heading clickable"><span>vue</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vuepress-notes/webpack/" class="sidebar-heading clickable router-link-active open"><span>webpack</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-notes/webpack/vue-loader.html" aria-current="page" class="active sidebar-link">Vue Loader</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-notes/webpack/vue-loader.html#webpack配置" class="sidebar-link">Webpack配置</a></li><li class="sidebar-sub-header"><a href="/vuepress-notes/webpack/vue-loader.html#处理资源路径" class="sidebar-link">处理资源路径</a></li><li class="sidebar-sub-header"><a href="/vuepress-notes/webpack/vue-loader.html#使用预处理器" class="sidebar-link">使用预处理器</a></li><li class="sidebar-sub-header"><a href="/vuepress-notes/webpack/vue-loader.html#css提取" class="sidebar-link">CSS提取</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-loader"><a href="#vue-loader" class="header-anchor">#</a> Vue Loader</h1> <h2 id="webpack配置"><a href="#webpack配置" class="header-anchor">#</a> Webpack配置</h2> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> VueLoaderPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-loader/lib/plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// ... 其它规则</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.vue$/</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'vue-loader'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 请确保引入这个插件！</span>
    <span class="token keyword">new</span> <span class="token class-name">VueLoaderPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个插件是必须的！ 它的职责是将你定义过的其它规则复制并应用到 <code>.vue</code> 文件里相应语言的块。例如，如果你有一条匹配 <code>/\.js$/</code>的规则，那么它会应用到 <code>.vue</code> 文件里的 <code>&lt;script&gt;</code> 块。</p> <p>一个更完整的 webpack 配置示例看起来像这样：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> VueLoaderPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-loader/lib/plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.vue$/</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'vue-loader'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 它会应用到普通的 `.js` 文件</span>
      <span class="token comment">// 以及 `.vue` 文件中的 `&lt;script&gt;` 块</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 它会应用到普通的 `.css` 文件</span>
      <span class="token comment">// 以及 `.vue` 文件中的 `&lt;style&gt;` 块</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'vue-style-loader'</span><span class="token punctuation">,</span> <span class="token comment">// forked from style-loader 。支持服务端渲染。Does not support url mode and reference counting mode. Also removed singleton and insertAt query options. It always automatically pick the style insertion mechanism that makes most sense. If you need these capabilities you should probably use the original style-loader instead.　Fixed the issue that root-relative URLs are interpreted against chrome:// urls and make source map URLs work for injected &lt;style&gt; tags in Chrome.</span>
          <span class="token string">'css-loader'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 请确保引入这个插件来施展魔法</span>
    <span class="token keyword">new</span> <span class="token class-name">VueLoaderPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="处理资源路径"><a href="#处理资源路径" class="header-anchor">#</a> 处理资源路径</h2> <p>当 Vue Loader 编译单文件组件中的  块时，它也会将所有遇到的资源 URL 转换为 webpack 模块请求。</p> <div class="language-markup extra-class"><pre class="language-markup"><code><span class="token comment">&lt;!-- 编译前 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../image.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 编译后</span>
<span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
    src<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../image.png'</span><span class="token punctuation">)</span> <span class="token comment">// 现在这是一个模块的请求了</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 默认下列标签/特性的组合会被转换，可在transformAssetUrls选项中配置</span>
<span class="token punctuation">{</span>
  video<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">,</span> <span class="token string">'poster'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  source<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">,</span>
  img<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">,</span>
  image<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'xlink:href'</span><span class="token punctuation">,</span> <span class="token string">'href'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'xlink:href'</span><span class="token punctuation">,</span> <span class="token string">'href'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此外，如果你配置了为  块使用 css-loader，则你的 CSS 中的资源 URL 也会被同等处理。</p> <ul><li>转换规则
<ul><li><p>如果路径是绝对路径 (例如 <code>/images/foo.png</code>)，会原样保留。</p></li> <li><p>如果路径以 <code>.</code> 开头，将会被看作相对的模块依赖，并按照你的本地文件系统上的目录结构进行解析。</p></li> <li><p>如果路径以 <code>~</code> 开头，其后的部分将会被看作模块依赖。这意味着你可以用该特性来引用一个 Node 依赖中的资源：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~some-npm-package/foo.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></code></pre></div></li> <li><p>如果路径以 <code>@</code> 开头，也会被看作模块依赖。如果你的 webpack 配置中给 <code>@</code> 配置了 alias，这就很有用了。所有 <code>vue-cli</code> 创建的项目都默认配置了将 <code>@</code> 指向 <code>/src</code>。</p></li></ul></li></ul> <h2 id="使用预处理器"><a href="#使用预处理器" class="header-anchor">#</a> 使用预处理器</h2> <p>Vue Loader根据<code>lang</code>属性和<code>webpack</code>配置中的<code>rules</code>自动推断出合适的<code>loader</code>来使用</p> <h3 id="sass"><a href="#sass" class="header-anchor">#</a> Sass</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>//安装
<span class="token function">npm</span> <span class="token function">install</span> -D sass-loader node-sass
</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// ... 忽略其它规则</span>

      <span class="token comment">// 普通的 `.scss` 文件和 `*.vue` 文件中的</span>
      <span class="token comment">// `&lt;style lang=&quot;scss&quot;&gt;` 块都应用它</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'vue-style-loader'</span><span class="token punctuation">,</span>
          <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
          <span class="token string">'sass-loader'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 插件忽略</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="sass-vs-scss"><a href="#sass-vs-scss" class="header-anchor">#</a> Sass vs Scss</h4> <p>注意 sass-loader 会默认处理不基于缩进的 scss 语法。为了使用基于缩进的 sass 语法，你需要向这个 loader 传递选项：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// webpack.config.js -&gt; module.rules</span>
<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.sass$/</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'vue-style-loader'</span><span class="token punctuation">,</span>
    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        indentedSyntax<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token comment">// sass-loader version &gt;= 8</span>
        sassOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
          indentedSyntax<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="共享变量"><a href="#共享变量" class="header-anchor">#</a> 共享变量</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// webpack.config.js -&gt; module.rules</span>
<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'vue-style-loader'</span><span class="token punctuation">,</span>
    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 你也可以从一个文件读取，例如 `variables.scss`</span>
        <span class="token comment">// 如果 sass-loader 版本 &lt; 8，这里使用 `data` 字段</span>
        prependData<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$color: red;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="babel"><a href="#babel" class="header-anchor">#</a> Babel</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> -D babel-core babel-loader
</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// webpack.config.js -&gt; module.rules</span>
<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.js?$/</span><span class="token punctuation">,</span>
  loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="排除-node-modules"><a href="#排除-node-modules" class="header-anchor">#</a> 排除 node_modules</h4> <p><code>exclude: /node_modules/</code> 在应用于 <code>.js</code> 文件的 JS 转译规则 (例如 <code>babel-loader</code>) 中是蛮常见的。鉴于 v15 中的推导变化，如果你导入一个 <code>node_modules</code> 内的 Vue 单文件组件，它的 <code>&lt;script&gt;</code> 部分在转译时将会被排除在外。</p> <p>为了确保 JS 的转译应用到 <code>node_modules</code> 的 Vue 单文件组件，你需要通过使用一个排除函数将它们加入白名单：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
  loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">exclude</span><span class="token operator">:</span> <span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
    <span class="token regex">/node_modules/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span><span class="token regex">/\.vue\.js/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="typescript"><a href="#typescript" class="header-anchor">#</a> TypeScript</h3> <div class="language-jsx extra-class"><pre class="language-jsx"><code>npm install <span class="token operator">-</span><span class="token constant">D</span> typescript ts<span class="token operator">-</span>loader
</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将 `.ts` 添加为一个可解析的扩展名。</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// ... 忽略其它规则</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.ts$/</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'ts-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span> appendTsSuffixTo<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex">/\.vue$/</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...plugin omitted</span>
<span class="token punctuation">}</span>
</code></pre></div><p>TypeScript 的配置可以通过 <code>tsconfig.json</code> 来完成。你也可以查阅 <a href="https://github.com/TypeStrong/ts-loader" target="_blank" rel="noopener noreferrer"><strong>ts-loader</strong><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的文档。</p> <h2 id="css提取"><a href="#css提取" class="header-anchor">#</a> CSS提取</h2> <blockquote><p>请只在生产环境下使用 CSS 提取，这将便于你在开发环境下进行热重载。</p></blockquote> <h3 id="webpack-4"><a href="#webpack-4" class="header-anchor">#</a> webpack 4</h3> <div class="language-jsx extra-class"><pre class="language-jsx"><code>npm install <span class="token operator">-</span><span class="token constant">D</span> mini<span class="token operator">-</span>css<span class="token operator">-</span>extract<span class="token operator">-</span>plugin
</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">var</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其它选项...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// ... 忽略其它规则</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span>
            <span class="token operator">?</span> <span class="token string">'vue-style-loader'</span>
            <span class="token operator">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
          <span class="token string">'css-loader'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ... 忽略 vue-loader 插件</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'style.css'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>你还可以查阅 <a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener noreferrer">mini-css-extract-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 文档。</p> <h3 id="webpack-3"><a href="#webpack-3" class="header-anchor">#</a> webpack 3</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> -D extract-text-webpack-plugin
</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">var</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;extract-text-webpack-plugin&quot;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其它选项...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// ...其它规则忽略</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          use<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
          fallback<span class="token operator">:</span> <span class="token string">'vue-style-loader'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...vue-loader 插件忽略</span>
    <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token string">&quot;style.css&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>你也可以查阅 <a href="https://github.com/webpack-contrib/extract-text-webpack-plugin" target="_blank" rel="noopener noreferrer">extract-text-webpack-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 文档。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress-notes/vue/source-code.html" class="prev">
        Vue源码阅读
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="vuepress-notes/assets/js/app.af0a4d6f.js" defer></script><script src="vuepress-notes/assets/js/2.bd6c3abc.js" defer></script><script src="vuepress-notes/assets/js/54.c6cb65e4.js" defer></script>
  </body>
</html>
